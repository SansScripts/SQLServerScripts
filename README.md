# SQLServerScripts - SQL Server DDL Generator

[![Java Version](https://img.shields.io/badge/Java-15%2B-blue)](https://adoptium.net/)
[![SQL Server](https://img.shields.io/badge/SQL%20Server-All%20Versions-red)](https://www.microsoft.com/sql-server)
[![License](https://img.shields.io/badge/License-Educational-green)](LICENSE)

A comprehensive Java application that connects to SQL Server databases and generates DDL (CREATE statements) for database objects. The tool provides both interactive and command-line interfaces, making it suitable for both exploratory use and automated workflows.

## Features

### Connection Management
- **Database Configuration**: Hostname, port (default: 1433), instance name, database name
- **Authentication**: SQL Server username/password authentication
- **Schema Selection**: Target specific schema (default: dbo)
- **Connection Validation**: Robust error handling with detailed connection feedback

### DDL Generation
- **Table Existence Validation**: Verifies table exists before scripting
- **Complete CREATE Statements**: Full table definition with:
  - Column names, data types, and constraints
  - NOT NULL constraints and DEFAULT values
  - IDENTITY columns and Primary Key constraints
- **Index Generation**: Creates all non-primary key indexes (unique and regular)
- **Foreign Key Constraints**: Generates ALTER TABLE statements for foreign keys
- **Header Comments**: Timestamped comments with table and generation info

### Output Options
- **Console Display**: View DDL directly in terminal with formatted output
- **File Export**: Save to structured directory with timestamped filenames
- **Multiple Tables**: Script multiple tables in a single session

### Directory Structure (Created on Demand)
```
SQLServerScripts/
├── scripts/              # Created when first saving
│   └── tables/           # Created when first table is saved
│       ├── customers_20250725_163045.sql
│       └── orders_20250725_163102.sql
└── (future: procedures/, functions/, views/)
```

## Requirements

- **Java**: JDK 15 or higher
- **Maven**: 3.6.0 or higher
- **SQL Server**: Any version with accessible system catalogs

## 🚀 Quick Start

### Build with Maven
```bash
mvn clean package
```

### Interactive Mode
```bash
# Run without arguments for interactive mode
java -jar target/sqlserver-scripts-1.0.0-jar-with-dependencies.jar
```

### CLI Mode - Export All Tables
```bash
java -jar target/sqlserver-scripts-1.0.0-jar-with-dependencies.jar export-tables \
  --server localhost \
  --database MyDatabase \
  --user sa \
  --password MyPassword \
  --output-dir ./exports
```

### CLI Mode - Export Single Table
```bash
java -jar target/sqlserver-scripts-1.0.0-jar-with-dependencies.jar export-table \
  --server localhost \
  --database MyDatabase \
  --user sa \
  --password MyPassword \
  --table Customers \
  --output-dir ./exports
```

### Example Session
```
=== SQLServerScripts - SQL Server DDL Generator ===
Generate CREATE statements for SQL Server database objects

Enter SQL Server connection details:

Server hostname/IP [localhost]: 
Port [1433]: 
Instance name (optional, press enter to skip): 
Database name (required): myapp_db
Username (required): sa
Password (required): mypassword
Schema [dbo]: 

Connecting to: jdbc:sqlserver://localhost:1433;databaseName=myapp_db
Schema: dbo
====================================================
✓ Successfully connected to SQL Server database!

===================================================
Enter table name to script: customers

Output options:
1. Display DDL in console only
2. Save DDL to file
Choose option (1 or 2): 2

✓ Created scripts directory
✓ Created tables directory
✓ DDL saved to: /Users/hi/Documents/SQLServerScripts/scripts/tables/customers_20250725_163045.sql
  File size: 1247 bytes

Script another table? (y/n): n

✓ SQLServerScripts session completed successfully!
```

## Generated DDL Example

```sql
-- DDL for table: dbo.customers
-- Generated by SQLServerScripts on 2025-07-25 16:30:45

CREATE TABLE [dbo].[customers] (
    [customer_id] int IDENTITY(1,1) NOT NULL,
    [name] nvarchar(50) NOT NULL,
    [email] nvarchar(100) NULL,
    [created_at] datetime NOT NULL DEFAULT (getdate()),
    CONSTRAINT [PK_customers] PRIMARY KEY CLUSTERED ([customer_id])
);

-- Indexes
CREATE UNIQUE INDEX [IX_customers_email] ON [dbo].[customers] ([email]);
CREATE INDEX [IX_customers_created_at] ON [dbo].[customers] ([created_at]);

-- Foreign Key Constraints
ALTER TABLE [dbo].[customers] ADD CONSTRAINT [FK_customers_orders] 
  FOREIGN KEY ([customer_id]) REFERENCES [dbo].[orders] ([customer_id]);
```

## SQL Server Data Type Support

The application properly handles all SQL Server data types:
- **Numeric**: int, bigint, decimal, numeric, float, real, money, smallmoney
- **String**: varchar, nvarchar, char, nchar, text, ntext
- **Date/Time**: datetime, datetime2, smalldatetime, date, time, datetimeoffset
- **Binary**: binary, varbinary, image
- **Other**: bit, uniqueidentifier, xml, geography, geometry

## Architecture 6 Extensibility

### Current Implementation
- **Table Scripting**: Complete DDL generation for tables
- **Modular Design**: Separate methods for different DDL components
- **Directory Management**: On-demand creation of script directories

### Planned Extensions
- **Views**: CREATE VIEW statements
- **Functions**: CREATE FUNCTION statements  
- **Procedures**: CREATE PROCEDURE statements
- **Triggers**: CREATE TRIGGER statements
- **Sequences**: CREATE SEQUENCE statements
- **Full Schema**: Script entire schema or database
- **Multiple Schemas**: Cross-schema scripting support

### Extensible Structure
```java
// Future method signatures:
generateViewDDL(conn, viewName, schema)
generateFunctionDDL(conn, functionName, schema)  
generateProcedureDDL(conn, procedureName, schema)
generateSchemaDDL(conn, schemaName)
generateFullInstanceDDL(conn)
```

## Error Handling

The application provides comprehensive error handling:
- **Connection Issues**: Clear database connection error messages
- **Authentication Failures**: Specific credential validation errors
- **Missing Objects**: Table existence validation with helpful messages
- **Permission Issues**: SQL permission errors with context
- **File System**: Directory creation and file writing error handling

## Output File Naming

Generated files follow this pattern:
- **Format**: `{tablename}_{timestamp}.sql`
- **Example**: `customers_20250725_163045.sql`
- **Location**: `scripts/tables/`
- **Timestamp**: YYYYMMDD_HHMMSS format

## Troubleshooting

### Common Issues

1. **Connection refused**: 
   - Ensure that SQL Server is running.
   - Verify hostname and port.
   - Check firewall or network settings.

2. **Authentication failed**:
   - Ensure correct username/password.
   - Verify that SQL Server Authentication is enabled.
   - Ensure user access to the specified database.

3. **Table not found**:
   - Verify table name and schema spelling.
   - Confirm that the table exists in the specified schema.
   - Ensure user has SELECT permissions on the table.

4. **Permission denied**:
   - Grant necessary permissions to access system catalogs.
   - Ensure appropriate role or user access.

## 📋 CLI Commands Reference

### export-tables Command
Exports all tables from a specified schema to individual SQL files.

```bash
java -jar sqlserver-scripts.jar export-tables [options]
```

**Options:**
- `-s, --server <host>` - SQL Server hostname (default: localhost)
- `-p, --port <port>` - Server port (default: 1433)
- `-d, --database <name>` - Database name (required)
- `-u, --user <username>` - Username (required)
- `-w, --password <password>` - Password (required)
- `--schema <name>` - Schema name (default: dbo)
- `-o, --output-dir <path>` - Output directory (default: current directory)
- `--exclude-indexes` - Skip index generation
- `--exclude-foreign-keys` - Skip foreign key generation
- `-v, --verbose` - Enable verbose output
- `-h, --help` - Show help message

### export-table Command
Exports a single table to a SQL file.

```bash
java -jar sqlserver-scripts.jar export-table [options]
```

**Additional Options:**
- `-t, --table <name>` - Table name to export (required)

## Related Projects

- **PostScripts**: PostgreSQL DDL generator
- **SQLServerConnect**: SQL Server database schema inspector
- **SQLgres**: SQL Server to PostgreSQL DDL converter
- Each project provides consistent interfaces and output formats

## Project Structure

```
SQLServerScripts/
├── src/
│   ├── main/
│   │   └── java/
│   │       └── com/dbtools/sqlserverscripts/
│   │           ├── SQLServerScripts.java    # Main application
│   │           └── ScriptOptions.java       # Configuration options
│   └── test/
│       └── java/
│           └── com/dbtools/sqlserverscripts/
│               └── TestScriptOptions.java   # Test for ScriptOptions
├── target/                                  # Maven build output
├── pom.xml                                  # Maven configuration
└── README.md                                # This documentation
```

## 🔧 Configuration Options

### ScriptOptions Class
The `ScriptOptions` class provides comprehensive configuration for DDL generation:

**Skip Flags:**
- `skipConstraintNames` - Omit constraint names
- `skipForeignKeys` - Omit foreign key constraints
- `skipIndexes` - Omit index creation statements
- `skipTriggers` - Omit triggers (future feature)
- `skipCheckConstraints` - Omit check constraints
- `skipUniqueKeys` - Omit unique key constraints
- `skipDefaults` - Omit default values
- `skipIdentity` - Omit IDENTITY specifications
- `skipCollation` - Omit collation settings
- `skipExtendedProperties` - Omit extended properties
- `skipStatistics` - Omit statistics
- `skipChangeTracking` - Omit change tracking
- `skipCompression` - Omit compression settings
- `skipPermissions` - Omit permissions

## 📦 Maven Dependencies

The project uses the following dependencies:

```xml
<dependencies>
    <!-- SQL Server JDBC Driver -->
    <dependency>
        <groupId>com.microsoft.sqlserver</groupId>
        <artifactId>mssql-jdbc</artifactId>
        <version>12.8.1.jre11</version>
    </dependency>
    
    <!-- Apache Commons CLI -->
    <dependency>
        <groupId>commons-cli</groupId>
        <artifactId>commons-cli</artifactId>
        <version>1.6.0</version>
    </dependency>
</dependencies>
```

## 🚀 Performance Considerations

- **Metadata Caching**: Queries are optimized to minimize database roundtrips
- **Batch Processing**: CLI mode processes tables sequentially with progress indication
- **Memory Usage**: Minimal memory footprint, suitable for large schemas
- **Connection Pooling**: Not implemented (single connection per session)

## 🔐 Security

- **Authentication**: SQL Server authentication only (Windows auth not supported)
- **SSL/TLS**: Disabled by default (`encrypt=false;trustServerCertificate=true`)
- **Password Handling**: Console masking in interactive mode
- **Permissions**: Requires SELECT on tables and VIEW DEFINITION on schema

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📄 License

This project is for educational and development use. The Microsoft SQL Server JDBC driver is subject to its own license terms.
